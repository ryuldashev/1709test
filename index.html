<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Bot Interface</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>–ü—Ä–æ—Å—Ç–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç–∞</h1>
        <p>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–æ–≥–æ–¥—É –≤ –¢–∞—à–∫–µ–Ω—Ç–µ:</p>
        <button class="send-message" onclick="sendWeather()">–ü–æ–ª—É—á–∏—Ç—å –ø–æ–≥–æ–¥—É</button>
        <p id="response"></p>
    </div>

    <script>
        const token = '7785038610:AAH9HVL2qBJuCEJG6fJKdmD2K3yY77VWT_Q';
        const chat_id = '82493329';

        async function sendWeather() {
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º CORS-–ø—Ä–æ–∫—Å–∏
                const corsProxy = 'https://cors-anywhere.herokuapp.com/';
                const weatherUrl = 'https://wttr.in/tashkent?format=j1';
                
                document.getElementById('response').innerText = '–ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≥–æ–¥–µ...';

                const weatherResponse = await fetch(corsProxy + weatherUrl, {
                    headers: {
                        'Origin': 'null',
                        'Accept': 'application/json'
                    }
                });
                
                if (!weatherResponse.ok) {
                    throw new Error(`HTTP error! status: ${weatherResponse.status}`);
                }
                
                const weatherData = await weatherResponse.json();
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø–æ–≥–æ–¥–µ
                const current = weatherData.current_condition[0];
                const weatherMessage = `üåç –ü–æ–≥–æ–¥–∞ –≤ –¢–∞—à–∫–µ–Ω—Ç–µ:
üå° –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${current.temp_C}¬∞C
‚òÅÔ∏è ${current.lang_ru[0].value}
üíß –í–ª–∞–∂–Ω–æ—Å—Ç—å: ${current.humidity}%
üí® –í–µ—Ç–µ—Ä: ${current.windspeedKmph} –∫–º/—á
üëÄ –í–∏–¥–∏–º–æ—Å—Ç—å: ${current.visibility} –∫–º
üïí –û–±–Ω–æ–≤–ª–µ–Ω–æ: ${current.observation_time}`;

                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram
                const encodedMessage = encodeURIComponent(weatherMessage);
                const telegramUrl = `https://api.telegram.org/bot${token}/sendMessage?chat_id=${chat_id}&text=${encodedMessage}`;
                
                const telegramResponse = await fetch(telegramUrl);
                const telegramData = await telegramResponse.json();

                if (telegramData.ok) {
                    document.getElementById('response').innerText = '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–≥–æ–¥–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ Telegram!';
                } else {
                    throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤ Telegram');
                }
            } catch (error) {
                document.getElementById('response').innerText = 
                    `–û—à–∏–±–∫–∞: ${error.message}. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.`;
                console.error('Detailed error:', error);
            }
        }
    </script>
</body>
</html>
